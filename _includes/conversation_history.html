<h5>Conversation</h5>
<div class="conversations">
  {% if milestone.conversation.size == 0 %}
    <p><b>The item isn't being discussed yet.</b></p>
  {% else %}
    {% for conversation in milestone.conversation %}
      {% assign owner = users[conversation.owner] %}
      <div class="conversation-block" style="">
        {% include user_avatar.html user=owner className="content-l_col" %}
        <p class="content-l_col content-l_col-3-4 conversation-block_item bubble" style="background: {{owner.bubble}}; color: {{owner.color}}; border-color: {{owner.bubble}}">
          <i data-timestamp="{{conversation.timestamp}}"></i>
          {{conversation.text}}
        </p>
      </div>
    {% endfor %}
  </div>
  {% if milestone.ready %}
    {% if milestone.completed %}
      {% assign class_name = 'btn__disabled' %}
      {% assign copy = 'Done' %}
    {% else %}
      {% assign class_name = '' %}
      {% assign copy ='Mark as done' %}
    {% endif %}

    <button class="btn {{class_name}} set-done">{{copy}}</button>
  {% else %}
    <form class="block comment-form">
      <textarea class="comment-form_comment"></textarea>
      <button type=submit class="submit-comment btn">Comment</button>
    </form>
  {% endif %}
{% endif %}

<script>
  window.addEventListener('load', function() {
    /** timestamps **/
    var timestamps = document.querySelectorAll('[data-timestamp]');
    var dates = [].slice.call(timestamps).forEach(function(el) {
      var time = el.getAttribute(['data-timestamp']);
      var formatted = moment(time, "MM-DD-YYYY").format("ddd, MMMM DD YYYY");
      el.textContent = 'on ' + formatted + ':';
    });

    /** commenting **/
    function handleComment(event) {
      event.preventDefault();

      if (submitting) {
        return;
      }

      var value = event.target.value;

      if (!value) {
        return;
      }
    }

    var submitButtons = document.querySelectorAll('submit-comment');
    [].slice.call(submitButtons).forEach(function(button) {
      button.addEventListener('click', handleComment);
    });

    /** mark as done **/
    function markAsDone(event) {
      var element = event.target;
      var convoTab = element.parentNode;
      var sectionTab = convoTab.parentNode;

      convoTab.setAttribute('aria-hidden', true);

      sectionTab.setAttribute('data-status', 'completed');
      sectionTab.querySelector('.status-label').textContent = 'Completed';
    }

    var doneButtons = document.querySelectorAll('.set-done');
    [].slice.call(doneButtons).forEach(function(el) {
      el.addEventListener('click', markAsDone);
    });
  });
</script>
